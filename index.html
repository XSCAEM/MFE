<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AEM Destination Selector â€“ Local Token Demo</title>

  <!-- Adobe Destination Selector bundle -->
  <!-- NOTE: this is the current Assets Selectors script URL -->
  <script src="https://experience.adobe.com/solutions/CQ-assets-selectors/assets/resources/assets-selectors.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; }
    .shell { display:flex; height:100vh; }
    .left { width:35%; padding:20px; background:#f5f5f5; border-right:1px solid #ccc; box-sizing:border-box; }
    .right { flex:1; padding:20px; box-sizing:border-box; }

    #tokenBox { width:100%; padding:6px; box-sizing:border-box; }
    #saveBtn { padding:6px 12px; margin-top:8px; cursor:pointer; }

    #destination-selector-container {
      height: calc(100vh - 200px);
      border: 1px solid #ddd;
      margin-top:20px;
      background:#fff;
    }
    pre {
      margin-top:10px;
      padding:10px;
      font-size:11px;
      border:1px solid #ccc;
      background:#fafafa;
      overflow:auto;
      max-height:200px;
      box-sizing:border-box;
    }
  </style>
</head>

<body>
  <div class="shell">

    <!-- LEFT SIDE: Fake CMS + Token UI -->
    <div class="left">
      <h2>Demo Setup</h2>
      <p><strong>Step 1:</strong> Paste your 24-hour AEM Local Dev IMS Access Token:</p>

      <textarea id="tokenBox" rows="4" placeholder="Paste IMS access token here"></textarea>
      <br/>
      <button id="saveBtn">ðŸ’¾ Save Token</button>

      <p style="margin-top:20px; font-size:12px; color:#555;">
        This token is stored ONLY in <code>localStorage</code> in this browser.
        <br/>It never leaves your machine and is not committed to GitHub.
      </p>

      <hr/>

      <h3>Selected AEM Folder</h3>
      <input
        id="pathInput"
        placeholder="Pick a folder on the right"
        readonly
        style="width:100%; padding:6px; box-sizing:border-box;"
      />
    </div>

    <!-- RIGHT: Destination Selector MFE -->
    <div class="right">
      <h2>AEM Destination Selector (Local Token)</h2>

      <div id="destination-selector-container"></div>

      <pre id="output">// Folder JSON will appear here</pre>
    </div>

  </div>

  <script>
    /** SAVE TOKEN TO LOCAL STORAGE **/
    document.getElementById("saveBtn").onclick = () => {
      const tok = document.getElementById("tokenBox").value.trim();
      if (!tok) {
        alert("Paste a token first!");
        return;
      }
      localStorage.setItem("imsToken", tok);
      alert("Token saved! Reload the page to activate the selector.");
    };

    window.addEventListener("load", () => {
      const container = document.getElementById("destination-selector-container");
      const output = document.getElementById("output");
      const pathInput = document.getElementById("pathInput");

      /** 1. LOAD TOKEN FROM LOCAL STORAGE **/
      const imsToken = localStorage.getItem("imsToken");

      if (!imsToken) {
        output.textContent = "// No token saved yet. Paste your token on the left and click Save, then reload.";
        return;
      }

      /** 2. ENSURE THE SELECTOR LIB LOADED **/
      if (typeof PureJSSelectors === "undefined") {
        output.textContent =
          "// assets-selectors.js did not load.\n" +
          "// Check the <script> URL and make sure you're serving this file over HTTP(S), not file://";
        return;
      }

      /** 3. RENDER DESTINATION SELECTOR WITH TOKEN **/
      const props = {
        // ðŸ”¹ Replace with YOUR IMS ORG from Admin Console / Dev Console
        imsOrg: "AF5F1E996757ECD00A495C0D@AdobeOrg",

        // ðŸ”¹ Our 24h Local Dev token (from localStorage)
        imsToken: imsToken,

        // ðŸ”¹ IMPORTANT: client_id from your Adobe Developer Console project
        // The same project where you added AEM Assets API and generated this local dev token.
        apiKey: "64ba5a2bba6f473fb9a43262d9730f6b",

        // Where to start browsing
        rootPath: "/content/dam",

        handleSelection: (sel) => {
          output.textContent = JSON.stringify(sel, null, 2);
          if (Array.isArray(sel) && sel.length > 0) {
            const first = sel[0];
            const path = first["repo:path"] || "(no path returned)";
            pathInput.value = path;
          }
        }
      };

      PureJSSelectors.renderDestinationSelector(container, props);
    });
  </script>
</body>
</html>
