<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Adobe Destination Selector â€“ MFE Demo</title>

    <!-- Adobe UMD bundle for Asset/Destination Selectors -->
    <script src="https://experience.adobe.com/solutions/CQ-assets-selectors/static-assets/resources/assets-selectors.js"></script>

    <style>
      body { font-family: Arial, sans-serif; margin: 0; }
      .shell { display: flex; height: 100vh; }

      .cms {
        width: 35%;
        border-right: 1px solid #ddd;
        padding: 20px;
        box-sizing: border-box;
        background: #f7f7f7;
      }
      .cms h2 { margin-top: 0; }
      .cms label { font-size: 12px; font-weight: bold; }
      .cms input {
        width: 100%;
        padding: 6px;
        margin: 4px 0 16px 0;
        box-sizing: border-box;
      }
      .preview-page {
        border: 1px solid #ccc;
        background: #fff;
        padding: 10px;
      }
      .preview-page h3 { margin-top: 0; }

      .mfe {
        width: 65%;
        padding: 20px;
        box-sizing: border-box;
      }
      .mfe h2 { margin-top: 0; }

      #destination-selector-container {
        height: calc(100vh - 200px);
        width: 100%;
        border: 1px solid #ddd;
        box-sizing: border-box;
      }
      pre {
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #ddd;
        background: #fafafa;
        font-size: 11px;
        max-height: 180px;
        overflow: auto;
      }
    </style>
  </head>

  <body>
    <div class="shell">
      <!-- Fake CMS pane (left) -->
      <div class="cms">
        <h2>Fake CMS Editor (Sitecore-like)</h2>

        <label>Page Title</label>
        <input id="titleInput"
               placeholder="Summer campaign"
               oninput="
                 document.getElementById('pageTitle').textContent =
                   this.value || 'Page Title';
               ">

        <label>Chosen AEM Folder Path</label>
        <input id="pathInput"
               placeholder="Pick a folder on the right"
               readonly />

        <h3>Page Preview</h3>
        <div class="preview-page">
          <h3 id="pageTitle">Page Title</h3>
          <p style='font-size: 12px; color:#555;'>
            Sitecore authors stay here, but when they need assets or folders,
            they use the embedded Adobe micro frontend on the right.
          </p>
          <p id="folderPreview"
             style='font-size: 11px; color:#777; word-break: break-all;'>
            Selected AEM folder: (none yet)
          </p>
        </div>
      </div>

      <!-- Real Adobe MFE pane (right) -->
      <div class="mfe">
        <h2>Adobe Destination Selector (Real Micro Frontend)</h2>
        <p style="font-size: 13px;">
          This is the official Adobe Destination Selector MFE, hosted by Adobe
          and embedded here via vanilla JavaScript. In a Sitecore integration,
          this panel would live inside the editor and let authors choose an AEM
          folder.
        </p>

        <div id="destination-selector-container"></div>

        <pre id="selectionOutput">// Selected destination JSON will appear here</pre>
      </div>
    </div>

    <script>
      window.addEventListener('load', () => {
        const container      = document.getElementById('destination-selector-container');
        const output         = document.getElementById('selectionOutput');
        const pathInput      = document.getElementById('pathInput');
        const folderPreview  = document.getElementById('folderPreview');

        // 1) Let Adobe handle auth (no manual imsToken)
        PureJSSelectors.registerAssetsSelectorsAuthService({
          imsClientId: "YOUR_CLIENT_ID_HERE", // API Key (Client ID)
          imsScope: "AdobeID,openid,additional_info.projectedProductContext,read_organizations",
          redirectUri: window.location.href
        });

        // 2) Render the Destination Selector MFE
        const destinationSelectorProps = {
          imsOrg: "AF5F1E996757ECD00A495C0D@AdobeOrg",
          apiKey: "YOUR_CLIENT_ID_HERE",
          rootPath: "/content/dam",
          handleSelection: (selection) => {
            output.textContent = JSON.stringify(selection, null, 2);

            if (Array.isArray(selection) && selection.length > 0) {
              const first = selection[0];
              const path = first["repo:path"] || "(no path)";
              pathInput.value = path;
              folderPreview.textContent = "Selected AEM folder: " + path;
            }
          }
        };

        PureJSSelectors.renderDestinationSelector(container, destinationSelectorProps);
      });
    </script>
  </body>
</html>
